# 운수종사자 교통사고 위험군 예측 프로젝트 (Dacon 경진대회)

운수종사자 검사 데이터(A/B검사)를 기반으로 교통사고 위험군을 예측하는 분류 모델 개발 프로젝트입니다.  
제공된 대규모 A/B 검사 데이터를 기반으로 다양한 반응·정확도·반응시간 기반 피처를 생성하고,  
A/B 검사 데이터를 분리 모델링하여 교통사고 위험군(0/1)을 예측하는 것을 목표로 진행되었습니다.

---

## 주요 컬럼

@ train.csv
| 컬럼명 | 설명 |
|-------|------|
| **Test_id** | 검사 식별 ID |
| **Test** | 검사 종류 (A: 신규자격 / B: 자격유지) |
| **PrimaryKey** | 운수종사자 식별 ID |
| **Age** | 나이 구간 (ex. 30a = 30 ~ 34, 30b = 35 ~ 39) |
| **TestDate** | 검사 년월(yyyymm) |
| **Label** | 사고 위험군 여부 (0/1) |

@ A.csv , B.csv
| 컬럼명 | 설명 |
|-------|------|
| **Test_id** | 검사 식별 ID |
| **Test** | 검사 종류 (A: 신규자격 / B: 자격유지) |
| **A1~A9 , B1~B10** | condition변수 , response변수 |
| **PrimaryKey** | 운수종사자 식별 ID |
| **Age** | 나이 구간 (ex. 30a = 30 ~ 34, 30b = 35 ~ 39) |
| **TestDate** | 검사 년월(yyyymm) |

---

## 프로젝트 전체 프로세스

- 데이터 로드 & 기본 구조 확인  
- A/B 검사별 구조 차이 분석  
- 항목별 카운트/정확도/반응률/반응시간 feature 설계  
- A/B 데이터를 분리하여 각각 모델 학습  
- 모델 평가 (AUC, Brier, ECE)  
- 최종 submit.zip 구성 후 제출  

---

## Feature Engineering (핵심)

본 프로젝트의 핵심은 각 검사 항목에서 제공되는 값들을:

1) **카운트 기반 변수**  
2) **정확도 기반 변수**  
3) **반응률 변수**  
4) **반응시간 분류 변수**  

로 정리해 **정형화된 피처 세트**를 만드는 것입니다.

특히 반응시간은 전체 분포를 기준으로 다음처럼 분류했습니다.

- 상위 25% (느림 그룹)  
- 중간 50%  
- 하위 25% (빠른 그룹)  

---

# A 검사 (신규 자격검사) Feature Summary

A 검사는 항목 종류가 많고 패턴이 복잡하기 때문에  
각 항목을 **카운트 / 정확도 / 반응률 / 반응시간** 형태로 구성했습니다.

> **response 피쳐만 고려**  
> Count로 변수를 만들기 때문에 condition 변수들의 각 환경 값이 의미가 없어짐  
> → condition 변수 제거하고 진행  

---

### **1) 터널 끝 지점 맞추기**
- 반응 여부 비율(0 = 반응, 1 = 미반응)  
- 반응시간 → 75% / 25% 기준 3단계 그룹화  

---

### **2) 적색선 위 정지 (속도 반영)**
- 반응률  
- 반응시간 → 75% / 25% 기준 3단계 그룹화

---

### **3) 화면 화살표 방향 반응**
- 정답/오답 정확도  
- 반응률  
- 반응시간 그룹화  

---

### **4) 원 색깔 구분**
- 정확도  
- 반응률  
- 반응시간 그룹화  

---

### **5) 그림판 BEFORE–AFTER 비교**
- 정확도  
- 반응률  

---

### **A 검사 특성 요약**
- 항목 수가 많아 다차원 행동 반응 패턴을 세밀히 반영  
- 반응시간 및 반응률이 사고 위험군 구분에 핵심적 역할  

---

# B 검사 (자격 유지검사) Feature Summary

B 검사는 A보다 구조가 단순하며  
**정확도 / 반응률 / 반응시간 그룹화**만으로 대부분 정리 가능합니다.

---

### **1) 화면 시야 자극 찾기**
- 정확도  
- 반응시간(Q2~Q3 범위 기반)  
- 변화 정확도  
* B1-3 에서 2,3,4로 분류된 것들은 반응시간이 0으로 되어있어서 0값을 빼고 계산

---

### **2) 시야 자극 찾기 2단계**
- 정확도  
- 반응시간(0값 제거 후 분포 기반)  
- 변화 정확도  
* B2-3 에서 2,3,4로 분류된 것들은 반응시간이 0으로 되어있어서 0값을 빼고 계산

---

### **3) 위험신호 → 즉시 브레이크**
- 정확도  
- 반응시간 그룹화  

---

### **4) 화살표 방향과 동일한 버튼 누르기**
- 일치 여부별 정확도  
- 반응시간 그룹화  

---

### **5~8) 도로 찾기 / 특정 지역 찾기(6,7) / 특정 차량 찾기**
- 도로 찾기만 정확도와 반응시간 그룹화
- 나머지는 각 항목별 정확도만 단일 변수로 처리

---

### **B 검사 특성 요약**
- 단순하지만 반응 정확도 위주의 선형적 피처 구조  
- 반응시간은 일부 항목에서 0값 제거 후 재산정 필요  

---

## Feature Selection

- Label(0/1) 두 그룹 간 **Cohen’s d가 낮은 변수 제거** 하고
다른 변수들과 **상관성 낮은 변수도 제거**  
→ 정보 공유가 거의 없는 요소 제거하여 과적합 방지  

---

# 모델링 전략

A와 B는 **문항 구조 / 반응 패턴 / 변수 의미가 완전히 다르기 때문에**,  
단일 모델로 합쳐 학습하면 성능이 저하될 수 있습니다.

따라서 아래처럼 **분리 모델링**을 적용했습니다.

| 데이터 | 사용 모델 |
|--------|-----------|
| **A 검사** | 모델 A |
| **B 검사** | 모델 B |

---
## 1. 데이터셋 분할

- A 검사 학습 데이터: `train_a`
- B 검사 학습 데이터: `train_b`
- 각 데이터셋에서:
  - `Label` 컬럼을 타깃으로 사용  
  - 나머지 피처를 입력 변수로 사용  
- `train_test_split`을 이용해 **train : valid = 7 : 3**, `stratify=Label`, `random_state=42`로 분할  
  - 클래스 비율(0/1)을 유지하면서 검증용 데이터를 분리  

---

## 2. 모델 구조

두 검사 유형 모두 **XGBoost의 XGBClassifier**를 사용하되,  
A/B 데이터의 불균형 정도가 달라 `scale_pos_weight`만 다르게 설정했습니다.

### 모델 

- 알고리즘: `XGBClassifier`
- 주요 하이퍼파라미터:
  - `n_estimators = 300`  (트리 개수)
  - `max_depth = 50`      (트리 최대 깊이)
  - `learning_rate = 0.005`
  - `scale_pos_weight = 43`  (Label 0:1 ≈ 43:1인 불균형 비율 반영) **[model b는 22:1]**
  - `objective = 'binary:logistic'`  (이진 분류 확률 출력)
  - `tree_method = 'hist'`           (히스토그램 기반 학습, 속도 향상)
  - `n_jobs = -1`
  - `random_state = 42`

→ 두 모델 모두 **클래스 불균형을 `scale_pos_weight`로 보정**해,  
  위험군(1) 클래스에 더 큰 가중치를 주도록 설계했습니다.

---

## 3. 확률 보정을 위한 Calibration

대회 평가지표에 **Brier Score, ECE(예측 확률의 신뢰도)**가 포함되어 있기 때문에,  
단순 분류 성능뿐 아니라 **“확률 자체의 품질”**이 중요하다고 판단단.

이를 위해 각 XGBoost 모델에 대해 **CalibratedClassifierCV**를 이용해 확률 보정을 수행했습니다.

- 방법: `CalibratedClassifierCV(model, method='isotonic', cv=5)`
  - `method = 'isotonic'` : 비선형 보정 방식으로, 예측 확률을 실제 빈도에 더 가깝게 맞춤
  - `cv = 5` : 5-Fold 교차검증으로 안정적인 보정 수행
- `model_a` → `calibrat값을 사용**합니다.

---

# 평가 지표

| Metric | 의미 | 방향 |
|--------|------|------|
| **AUC** | 사고 위험군 구분 능력 | ↑ 높을수록 좋음 |
| **Brier Score** | 예측 확률의 오차 | ↓ 낮을수록 좋음 |
| **ECE** | 예측 신뢰도 보정 정도 | ↓ 낮을수록 좋음 |

---

## 최종 점수 산식
- Score = 0.5 × (1 − AUC) + 0.25 × Brier + 0.25 × ECE

---



